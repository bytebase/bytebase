syntax = "proto3";

package bytebase.store;

import "store/approval.proto";
import "store/issue.proto";

option go_package = "generated-go/store";

message IssueCommentPayload {
  string comment = 1;

  oneof event {
    Approval approval = 2;
    IssueUpdate issue_update = 3;
    PlanSpecUpdate plan_spec_update = 7;
  }

  message Approval {
    IssuePayloadApproval.Approver.Status status = 1;
  }

  message IssueUpdate {
    optional string from_title = 1;
    optional string to_title = 2;
    optional string from_description = 3;
    optional string to_description = 4;
    optional Issue.Status from_status = 5;
    optional Issue.Status to_status = 6;
    repeated string from_labels = 7;
    repeated string to_labels = 8;
  }

  // Plan spec update event (tracks sheet changes to plan specs)
  message PlanSpecUpdate {
    // The spec that was updated
    // Format: projects/{project}/plans/{plan}/specs/{spec}
    string spec = 1;
    // The SHA256 hash of the previous sheet content (hex-encoded).
    optional string from_sheet_sha256 = 2;
    // The SHA256 hash of the new sheet content (hex-encoded).
    optional string to_sheet_sha256 = 3;
  }
}
