syntax = "proto3";

package bytebase.store;

import "store/advice.proto";
import "store/changelog.proto";
import "store/common.proto";

option go_package = "generated-go/store";

message PlanCheckRunConfig {
  int32 sheet_uid = 1;
  string instance_id = 2;
  string database_name = 3;

  map<string, string> ghost_flags = 4;

  // If set, a backup of the modified data will be created automatically before any changes are applied.
  bool enable_prior_backup = 5;

  // Whether to use gh-ost for online schema migration.
  bool enable_ghost = 6;

  // Whether this is a Schema Definition Language (SDL) change.
  bool enable_sdl = 7;
}

message PlanCheckRunResult {
  repeated Result results = 1;
  string error = 2;

  message Result {
    Advice.Status status = 1;
    string title = 2;
    string content = 3;
    int32 code = 4;

    oneof report {
      SqlSummaryReport sql_summary_report = 5;
      SqlReviewReport sql_review_report = 6;
    }
    message SqlSummaryReport {
      // statement_types are the types of statements found in the SQL.
      repeated string statement_types = 1;
      int64 affected_rows = 2;
      ChangedResources changed_resources = 3;
    }
    message SqlReviewReport {
      // Position of the SQL statement.
      Position start_position = 1;
      Position end_position = 2;
    }
  }
}
