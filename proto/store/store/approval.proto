syntax = "proto3";

package bytebase.store;

import "store/common.proto";

option go_package = "generated-go/store";

// IssuePayloadApproval is a part of the payload of an issue.
// IssuePayloadApproval records the approval template used and the approval history.
message IssuePayloadApproval {
  message Approver {
    enum Status {
      STATUS_UNSPECIFIED = 0;
      PENDING = 1;
      APPROVED = 2;
      REJECTED = 3;
    }
    // The new status.
    Status status = 1;

    // The principal id of the approver.
    int32 principal_id = 2;
  }

  ApprovalTemplate approval_template = 1;
  repeated Approver approvers = 2;

  // If the value is `false`, it means that the backend is still finding matching approval templates.
  // If `true`, other fields are available.
  bool approval_finding_done = 3;

  string approval_finding_error = 4;

  RiskLevel risk_level = 5;
}

message ApprovalTemplate {
  // The unique identifier for the approval template.
  // For built-in templates, use "bb." prefix (e.g., "bb.project-owner", "bb.workspace-dba").
  // For custom templates, use a UUID or other unique identifier.
  string id = 4;
  ApprovalFlow flow = 1;
  string title = 2;
  string description = 3;
}

message ApprovalFlow {
  repeated string roles = 1;
}
