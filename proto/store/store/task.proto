syntax = "proto3";

package bytebase.store;

import "store/common.proto";

option go_package = "generated-go/store";

// Task is the metadata for database operation tasks.
message Task {
  // Type represents the type of database operation to perform.
  enum Type {
    TASK_TYPE_UNSPECIFIED = 0;
    // Create a new database.
    DATABASE_CREATE = 1;
    // Apply schema/data migrations to an existing database.
    DATABASE_MIGRATE = 2;
    // Export data from a database.
    DATABASE_EXPORT = 3;
    // Apply declarative schema changes (state-based migration).
    DATABASE_SDL = 4;
  }

  // Whether the task was skipped during execution.
  bool skipped = 1;
  // Reason why the task was skipped.
  string skipped_reason = 2;
  // UUID that identifies the spec this task implements.
  string spec_id = 3;

  // The environment where the database will be created.
  string environment_id = 5;
  // Name of the database to create.
  string database_name = 6;
  // Optional table name to create (required for some databases like MongoDB).
  string table_name = 7;
  // Character set for the new database.
  string character_set = 8;
  // Collation for the new database.
  string collation = 9;

  // Source of the task's SQL content - either a single sheet or an entire release.
  oneof source {
    // The SHA256 hash of a single sheet content (hex-encoded).
    // Used for non-release tasks.
    string sheet_sha256 = 10;
    // The release resource name: projects/{project}/releases/{release}.
    // Used for GitOps release-based tasks that execute multiple files.
    string release = 13;
  }

  // Whether to create an automatic backup before applying changes.
  bool enable_prior_backup = 11;
  // Configuration flags for gh-ost migration tool.
  map<string, string> flags = 12;

  // Password to encrypt the exported data archive.
  string password = 14;
  // Format of the exported data (SQL, CSV, JSON, etc).
  ExportFormat format = 15;
  // Whether to use gh-ost for online schema migration.
  bool enable_ghost = 16;
}
