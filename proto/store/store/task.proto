syntax = "proto3";

package bytebase.store;

option go_package = "generated-go/store";

// Task is the metadata for database operation tasks.
message Task {
  // Type represents the type of database operation to perform.
  enum Type {
    TASK_TYPE_UNSPECIFIED = 0;
    // Create a new database.
    DATABASE_CREATE = 1;
    // Apply schema/data migrations to an existing database.
    // Execution strategy is determined by release type (VERSIONED/DECLARATIVE)
    // or sheet content for non-release tasks.
    DATABASE_MIGRATE = 2;
    // Export data from a database.
    DATABASE_EXPORT = 3;
  }

  // Whether the task was skipped during execution.
  bool skipped = 1;
  // Reason why the task was skipped.
  string skipped_reason = 2;
  // UUID that identifies the spec this task implements.
  string spec_id = 3;

  // Source of the task's SQL content - either a single sheet or an entire release.
  oneof source {
    // The SHA256 hash of a single sheet content (hex-encoded).
    // Used for non-release tasks.
    string sheet_sha256 = 10;
    // The release resource name: projects/{project}/releases/{release}.
    // Used for GitOps release-based tasks that execute multiple files.
    string release = 13;
  }

  // Whether to create an automatic backup before applying changes.
  bool enable_prior_backup = 11;
  // Configuration flags for gh-ost migration tool.
  map<string, string> flags = 12;

  // Whether to use gh-ost for online schema migration.
  bool enable_ghost = 16;
}
