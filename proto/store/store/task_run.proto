syntax = "proto3";

package bytebase.store;

import "google/protobuf/timestamp.proto";

option go_package = "generated-go/store";

// TaskRun represents an execution attempt of a task.
message TaskRun {
  // Status represents the current execution state of a task run.
  enum Status {
    STATUS_UNSPECIFIED = 0;
    // Task run is queued and waiting to execute.
    PENDING = 1;
    // Task run is currently executing.
    RUNNING = 2;
    // Task run completed successfully.
    DONE = 3;
    // Task run encountered an error and failed.
    FAILED = 4;
    // Task run was canceled by user or system.
    CANCELED = 5;
    // Task run has not started yet.
    NOT_STARTED = 6;
    // Task run was skipped and will not execute.
    SKIPPED = 7;
    // Task run is ready for immediate execution.
    AVAILABLE = 8;
  }
}

// TaskRunResult contains the outcome and metadata from a task run execution.
message TaskRunResult {
  // Error message for failed task runs. Empty for successful or canceled runs.
  string detail = 1;

  // UID of the export archive generated for export tasks.
  int32 export_archive_uid = 5;

  // Indicates whether a prior backup was created for this task run.
  // When true, the task run can be rolled back using the backup tables.
  // Backup details are available in the task run logs (PRIOR_BACKUP log entries).
  bool has_prior_backup = 6;
}

// SchedulerInfo contains information about task scheduling and execution delays.
message SchedulerInfo {
  // Timestamp when the scheduler reported this information.
  google.protobuf.Timestamp report_time = 1;

  // WaitingCause indicates why a task run is waiting to execute.
  message WaitingCause {
    oneof cause {
      // Task is waiting due to parallel execution limit.
      bool parallel_tasks_limit = 3;
    }
  }
  // Reason why the task run is currently waiting.
  WaitingCause waiting_cause = 2;
}
